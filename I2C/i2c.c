


#include "i2c.h"


void TWI_start()
{

	TWI_CONTROL_REGISTER|=(1<<TWI_INTERRUPT_FLAG)|
						  (1<<TWI_START)|
						  (1<<TWI_ENABLE);

	while(BIT_IS_CLEAR(TWI_CONTROL_REGISTER,TWI_INTERRUPT_FLAG));
}


void TWI_stop()
{

	TWI_CONTROL_REGISTER|=(1<<TWI_INTERRUPT_FLAG)|
						  (1<<TWI_STOP)|
						  (1<<TWI_ENABLE);

	while(BIT_IS_CLEAR(TWI_CONTROL_REGISTER,TWI_INTERRUPT_FLAG));

}


void TWI_send(uint8_t data)
{
	TWI_DATA_REGISTER=data;

	TWI_CONTROL_REGISTER|=(1<<TWI_INTERRUPT_FLAG)|
						  (1<<TWI_ENABLE);

	while(BIT_IS_CLEAR(TWI_CONTROL_REGISTER,TWI_INTERRUPT_FLAG));

}


uint8_t TWI_read()
{
	TWI_CONTROL_REGISTER|=(1<<TWI_INTERRUPT_FLAG)|
						  (1<<TWI_ENABLE);

	while(BIT_IS_CLEAR(TWI_CONTROL_REGISTER,TWI_INTERRUPT_FLAG));

	return TWI_DATA_REGISTER;
}

uint8_t TWI_getStatus()
{

	return (TWI_STATUS_REGISTER & TWI_MASK_STATUS_BITS);

}


uint8_t TWI_getFlag(TWI_FLAG TWI_FLAG)
{

	if(TWI_FLAG==_INTERRUPT_FLAG_TWI)
	{

	return MASK_BITS_THEN_SHIFT_LEFT(TWI_CONTROL_REGISTER,TWI_INTERRUPT_FLAG,BIT_7);

	}
	else
	{

	return MASK_BITS_THEN_SHIFT_LEFT(TWI_CONTROL_REGISTER,TWI_WRITE_COLLISION_FLAG,BIT_3);

	}

}




bool TWI_interruptDisable()
{


	RESET_BIT(TWI_CONTROL_REGISTER,TWI_INTERRUPT_ENABLE);


	return TRUE;
}



bool TWI_disable()
{

	RESET_BIT(TWI_CONTROL_REGISTER,TWI_ENABLE);

	return TRUE;
}
